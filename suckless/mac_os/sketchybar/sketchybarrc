#!/opt/homebrew/bin/bash

# Modern aesthetic sketchybar configuration with aerospace integration
# Colors and icons are defined in separate files for better organization

source "$CONFIG_DIR/colors.sh"
source "$CONFIG_DIR/icons.sh"

PLUGIN_DIR="$CONFIG_DIR/plugins"

##### Bar Appearance - Modern Glassy Design #####
sketchybar --bar position=bottom height=32 \
                 color=$BAR_COLOR \
                 border_width=0 \
                 corner_radius=0 \
                 margin=0 \
                 blur_radius=30 \
                 padding_left=4 \
                 padding_right=12 \
                 shadow=on \
                 sticky=on \
                 topmost=window \
                 y_offset=0 \
                 notch_width=200

##### Changing Defaults - Elegant Modern Style #####
default=(
  updates=when_shown
  icon.font="JetbrainsMono Nerd Font Propo:Semibold:15.0"
  icon.color=$ICON_COLOR
  icon.padding_left=8
  icon.padding_right=8
  label.font="JetbrainsMono Nerd Font Propo:Medium:13.0"
  label.color=$LABEL_COLOR
  label.padding_left=8
  label.padding_right=8
  padding_left=10
  padding_right=10
  background.height=28
  background.corner_radius=9
  background.border_width=0
  background.color=$BACKGROUND_1
  background.shadow.drawing=on
  background.shadow.color=$SHADOW_COLOR
  background.shadow.angle=90
  background.shadow.distance=2
  popup.background.border_width=1
  popup.background.corner_radius=12
  popup.background.border_color=$POPUP_BORDER_COLOR
  popup.background.color=$POPUP_BACKGROUND_COLOR
  popup.background.shadow.drawing=on
  popup.background.shadow.color=$SHADOW_COLOR
  popup.background.shadow.angle=90
  popup.background.shadow.distance=4
)

sketchybar --default "${default[@]}"

##### Left Side Items #####

# Apple Logo - Elegant brand icon
sketchybar --add item logo left \
           --set logo icon=$APPLE \
                           icon.font="JetbrainsMono Nerd Font Propo:Semibold:22.0" \
                           icon.color=$ACCENT_TERTIARY \
                           padding_right=0 \
                           padding_left=0 \
                           label.drawing=off \
                           background.color=$BACKGROUND_1 \
                           background.corner_radius=11 \
                           background.height=30 \
                           background.drawing=off \
                           click_script="$PLUGIN_DIR/apple.sh" \

# Aerospace Display-Aware Workspaces
sketchybar --add event aerospace_workspace_change

sketchybar --add item space left \
           --subscribe space aerospace_workspace_change \
           --set space \
                 padding_left=0 \
                 padding_right=0 \
                 icon.padding_left=0 \
                 icon.padding_right=0 \
                 label.padding_left=0 \
                 label.padding_right=0 \
                 background.drawing=off \
                 script="$PLUGIN_DIR/aerospace_display.sh" \
                 click_script="$PLUGIN_DIR/aerospace_click.sh" \
                 popup.background.border_width=2 \
                 popup.background.corner_radius=6 \
                 popup.background.border_color=$POPUP_BORDER_COLOR \
                 popup.background.color=$POPUP_BACKGROUND_COLOR

# Monitor change handler for app movement
sketchybar --add item display center \
  --subscribe display display_change \
  --set display script="$PLUGIN_DIR/display_change.sh" \
                background.drawing=off \
                padding_left=0 \
                padding_right=0 \
                icon.drawing=off \
                label.drawing=off \


# Devops tools
sketchybar --add item devops left \
           --set devops icon=$DEVOPS \
                        icon.color=$ACCENT_TEAL \
                        icon.font="JetbrainsMono Nerd Font Propo:Semibold:19.0" \
                        update_freq=10  \
                        icon.padding_left=10 \
                        icon.padding_right=10 \
                        label.drawing=off \
                        background.color=$BACKGROUND_1 \
                        background.drawing=on \
                        background.corner_radius=9 \
                        background.height=28 \
                        padding_left=15 \
                        padding_right=3 \
                        click_script="$PLUGIN_DIR/devops.sh"

# GitHub Notifications
# sketchybar --add item github left \
#            --set github icon=$GITHUB \
#                         icon.color=$GREY \
#                         icon.font="JetbrainsMono Nerd Font Propo:Semibold:18.0" \
#                         update_freq=60  \
#                         icon.padding_left=8 \
#                         label.font="JetbrainsMono Nerd Font Propo:Medium:14.0" \
#                         label.color=$WHITE \
#                         label.drawing=on \
#                         background.color=$BACKGROUND_1 \
#                         background.drawing=off \
#                         padding_left=4 \
#                         padding_right=4 \
#                         script="$PLUGIN_DIR/github.sh" \
#                         click_script="open https://github.com/notifications?query=is%3Aunread"

# VPN
sketchybar --add item vpn left \
           --set vpn icon="􀤆" \
                        icon.font="JetbrainsMono Nerd Font Propo:Semibold:14.0" \
                        update_freq=10  \
                        icon.padding_left=10 \
                        icon.padding_right=10 \
                        label.drawing=off \
                        background.color=$BACKGROUND_1 \
                        background.drawing=on \
                        background.corner_radius=9 \
                        background.height=28 \
                        padding_left=3 \
                        padding_right=3 \
                        script="$PLUGIN_DIR/vpn.sh" \
                        click_script="$PLUGIN_DIR/toggle_vpn.sh"

# Docker
sketchybar --add item docker left \
           --set docker icon="󰀘" \
                        icon.font="JetbrainsMono Nerd Font Propo:Semibold:16.0" \
                        icon.color=$ACCENT_PRIMARY \
                        update_freq=10  \
                        icon.padding_left=10 \
                        icon.padding_right=10 \
                        label.drawing=off \
                        background.color=$BACKGROUND_1 \
                        background.drawing=on \
                        background.corner_radius=9 \
                        background.height=28 \
                        padding_left=3 \
                        padding_right=15 \
                        script="$PLUGIN_DIR/docker.sh" \
                        click_script="$PLUGIN_DIR/toggle_docker.sh"

sketchybar --add item front_app left \
           --set front_app icon.drawing=on \
                          icon.font="sketchybar-app-font:Regular:17" \
                          icon.color=$ACCENT_QUATERNARY \
                          icon.padding_left=0 \
                          icon.padding_right=4 \
                          padding_left=0 \
                          label.font="JetbrainsMono Nerd Font Propo:Medium:13.0" \
                          label.color=$LABEL_COLOR \
                          label.padding_left=4 \
                          label.padding_right=10 \
                          background.color=$BACKGROUND_1 \
                          background.drawing=off \
                          background.corner_radius=9 \
                          background.height=28 \
                          script="$PLUGIN_DIR/front_app.sh" \
                          click_script="/opt/homebrew/bin/aerospace focus-back-and-forth" \
           --subscribe front_app front_app_switched



##### Right Side Items #####

# Clock - Elegant time display
sketchybar --add item clock right \
           --set clock icon="󰅐" \
                       icon.font="JetbrainsMono Nerd Font Propo:Semibold:15.0" \
                       icon.color=$ACCENT_GOLD \
                       icon.padding_left=10 \
                       icon.padding_right=8 \
                       label.font="JetbrainsMono Nerd Font Propo:Medium:13.0" \
                       label.color=$LABEL_COLOR \
                       label.padding_left=0 \
                       label.padding_right=10 \
                       update_freq=10 \
                       script="$PLUGIN_DIR/clock.sh" \
                       background.color=$BACKGROUND_1 \
                       background.drawing=off \
                       background.corner_radius=9 \
                       background.height=28 \
                       padding_left=4 \
                       padding_right=6 \
                       click_script="$PLUGIN_DIR/clock_click.sh"

 # CPU
sketchybar --add item cpu right \
           --set cpu icon.font="JetbrainsMono Nerd Font Propo:Semibold:17.0" \
                        icon.padding_left=8 \
                        icon.padding_right=6 \
                        label.font="JetbrainsMono Nerd Font Propo:Medium:14.0" \
                        label.padding_left=0 \
                        label.padding_right=0 \
                        update_freq=10 \
                        script="$PLUGIN_DIR/cpu.sh" \
                        background.color=$BACKGROUND_1 \
                        background.drawing=off \
                        padding_left=0 \
                        padding_right=0 \
# RAM
sketchybar --add item ram right \
           --set ram icon.font="JetbrainsMono Nerd Font Propo:Semibold:17.0" \
                        icon=$RAM \
                        icon.color=$MAGENTA \
                        icon.padding_left=8 \
                        icon.padding_right=6 \
                        label.font="JetbrainsMono Nerd Font Propo:Medium:14.0" \
                        label.padding_left=0 \
                        label.padding_right=4 \
                        update_freq=10 \
                        script="$PLUGIN_DIR/ram.sh" \
                        background.color=$BACKGROUND_1 \
                        background.drawing=off \
                        padding_left=0 \
                        padding_right=0 \

# Disk - Storage indicator
sketchybar --add item disk right \
           --set disk icon.font="JetbrainsMono Nerd Font Propo:Semibold:15.0" \
                             icon=$DISK \
                             icon.color=$RED \
                             icon.padding_left=8 \
                             icon.padding_right=4 \
                             label.drawing=on \
                             update_freq=60 \
                             label.font="JetbrainsMono Nerd Font Propo:Medium:13.0" \
                             label.color=$LABEL_COLOR \
                             label.padding_left=0 \
                             label.padding_right=4 \
                             script="$PLUGIN_DIR/disk.sh" \
                             background.color=$BACKGROUND_1 \
                             background.drawing=off \
                             background.corner_radius=9 \
                             background.height=28 \
                             padding_left=0 \
                             padding_right=0



# Calendar Events
# sketchybar --add item calendar right \
#            --set calendar icon.font="JetbrainsMono Nerd Font Propo:Semibold:14.0" \
#                           icon.padding_left=5 \
#                           icon.padding_right=5 \
#                           label.font="JetbrainsMono Nerd Font Propo:Medium:13.0" \
#                           label.color=$LABEL_COLOR \
#                           label.padding_left=2 \
#                           label.padding_right=5 \
#                           label.max_chars=25 \
#                           update_freq=300 \
#                           script="$PLUGIN_DIR/calendar.sh" \
#                           background.color=$BACKGROUND_1 \
#                           background.drawing=on \
#                           background.corner_radius=9 \
#                           background.height=28 \
#                           padding_left=4 \
#                           padding_right=4
#

# Now Playing
sketchybar --add item now_playing right \
           --set now_playing icon.font="JetbrainsMono Nerd Font Propo:Semibold:15.0" \
                            icon.color=$ACCENT_PRIMARY \
                            icon.padding_left=8 \
                            icon.padding_right=6 \
                            label.font="JetbrainsMono Nerd Font Propo:Medium:13.0" \
                            label.color=$LABEL_COLOR \
                            label.padding_left=0 \
                            label.padding_right=10 \
                            update_freq=2 \
                            script="$PLUGIN_DIR/now_playing.sh" \
                            background.color=$BACKGROUND_1 \
                            background.drawing=on \
                            background.corner_radius=9 \
                            background.height=28 \
                            drawing=off \
                            padding_left=4 \
                            padding_right=4

# Volume - Elegant audio control
sketchybar --add item volume right \
           --set volume icon.font="JetbrainsMono Nerd Font Propo:Semibold:15.0" \
                        icon.color=$ACCENT_PRIMARY \
                        icon.padding_left=5 \
                        icon.padding_right=10 \
                        label.drawing=off \
                        script="$PLUGIN_DIR/volume.sh" \
                        background.color=$BACKGROUND_1 \
                        background.drawing=on \
                        background.corner_radius=9 \
                        background.height=28 \
                        padding_left=4 \
                        padding_right=4 \
                        click_script="$PLUGIN_DIR/volume_click.sh" \
                        popup.background.border_width=2 \
                        popup.background.corner_radius=6 \
                        popup.background.border_color=$POPUP_BORDER_COLOR \
                        popup.background.color=$POPUP_BACKGROUND_COLOR \
                        popup.horizontal=on \
           --subscribe volume volume_change


# Input Source
# sketchybar --add       event              input_change 'AppleSelectedInputSourcesChangedNotification' \
#             --add item input_source right \
#             --set input_source icon.font="JetbrainsMono Nerd Font Propo:Semibold:14.0" \
#                               icon.padding_left=10 \
#                               icon.padding_right=12 \
#                               label.drawing=off \
#                               script="$PLUGIN_DIR/get_input_source.sh" \
#                               background.color=$BACKGROUND_1 \
#                               background.drawing=on \
#                               padding_left=2 \
#                               padding_right=2 \
#                               --subscribe input_source           input_change
#


# Battery - Power indicator
sketchybar --add item battery right \
           --set battery icon.font="JetbrainsMono Nerd Font Propo:Semibold:15.0" \
                        icon.color=$ACCENT_SECONDARY \
                        icon.padding_left=8 \
                        icon.padding_right=6 \
                        label.font="JetbrainsMono Nerd Font Propo:Medium:13.0" \
                        label.color=$LABEL_COLOR \
                        label.padding_left=0 \
                        label.padding_right=8 \
                        update_freq=120 \
                        script="$PLUGIN_DIR/battery.sh" \
                        background.color=$BACKGROUND_1 \
                        background.drawing=off \
                        background.corner_radius=9 \
                        background.height=28 \
                        padding_left=0 \
                        padding_right=0 \
           --subscribe battery system_woke power_source_change

# Weather
# sketchybar --add item weather right \
#            --set weather icon="󰖕" \
#                         icon.font="JetbrainsMono Nerd Font Propo:Semibold:16.0" \
#                         icon.color=$BLUE \
#                         icon.padding_left=8 \
#                         icon.padding_right=6 \
#                         label.padding_left=4 \
#                         label.padding_right=8 \
#                         update_freq=1800 \
#                         script="$PLUGIN_DIR/weather.sh" \
#                         background.color=$BACKGROUND_1 \
#                         background.drawing=off \
#                         padding_left=4 \
#                         padding_right=4
#
# Bluetooth Status
# sketchybar --add item bluetooth right \
#           --set bluetooth icon.font="JetbrainsMono Nerd Font Propo:Semibold:16.0" \
#           icon.padding_left=9 \
#           icon.padding_right=9 \
#           label.drawing=off \
#           update_freq=10 \
#           script="$PLUGIN_DIR/bluetooth.sh" \
#           background.color=$BACKGROUND_1 \
#           background.drawing=off \
#           padding_left=2 \
#           padding_right=2
#
# WiFi Status - Network indicator
sketchybar --add item wifi right \
           --set wifi icon.font="JetbrainsMono Nerd Font Propo:Semibold:15.0" \
                      icon.color=$ACCENT_TEAL \
                      icon.padding_left=8 \
                      icon.padding_right=8 \
                      label.drawing=off \
                      update_freq=10 \
                      script="$PLUGIN_DIR/wifi.sh" \
                      background.color=$BACKGROUND_1 \
                      background.drawing=off \
                      background.corner_radius=9 \
                      background.height=28 \
                      padding_left=0 \
                      padding_right=0

#

##### Finalize Setup #####
sketchybar --update

